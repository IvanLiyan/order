<!doctype html><html lang="en"><head><meta charset="UTF-8"><title>问题详情</title><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><script src="AES/tripledes.js"></script><script src="AES/mode-ecb.js"></script><script src="js/mui.min.js"></script><script src="js/app.js"></script><script src="js/jquery.min.js"></script><script src="js/rem.js"></script><script src="js/sysdict.js"></script><link rel="stylesheet" href="../app/css/mui.min.css"><link rel="stylesheet" href="../app/css/detail.css"></head><body><div class="mui-scroll-wrapper"><div class="mui-scroll"><div class="mui-content"><div class="detail-wrapper"><div class="header"></div><div class="header-b"></div><div class="info"></div><div class="mess"></div></div><div class="reply"><div class="replyHeader"></div><ul class="replyUl"></ul></div></div></div></div><script>function hideName(s,e,t,a){var l=s.length,r=s.slice(-1);return e===t||e===a?s:"2"===l?"*"+r:"**"+r}function changeIcon(s){return"01"===s?"reply-icon-me":"reply-icon-fuwuqu"}function replyName(s,e,t,a){return"01"===s&&e===t?($(".replyUl").find("i").prop("class","reply-icon-me"),"我"):"01"===s&&e!==t?"用户":"02"===s?"服务区":void 0}function moneyFormat(s,e){e=e>0&&e<=20?e:2,s=parseFloat((s+"").replace(/[^\d\.-]/g,"")).toFixed(e)+"";var a=s.split(".")[0].split("").reverse(),l=s.split(".")[1];for(t="",i=0;i<a.length;i++)t+=a[i]+((i+1)%3==0&&i+1!=a.length?",":"");return"￥"+t.split("").reverse().join("")+"."+l}function timeFormat(s){return s.substr(0,4)+"年"+s.substring(4,6)+"月"+s.substring(6,8)+"日 "+s.substring(8,10)+":"+s.substring(10,12)}function numFormat(s){s.slice(-6)}function getTime(){function s(s){return s<10?"0"+s:""+s}var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,l=e.getDate(),r=e.getHours(),i=e.getMinutes();return timeFormat(t+s(a)+s(l)+s(r)+s(i))}function urlParse(){var s=window.location.search,e={},t=s.match(/[?&][^?&]+=[^?&]+/g);return t&&t.forEach(function(s){var t=s.substring(1).split("="),a=decodeURIComponent(t[0]),l=decodeURIComponent(t[1]);e[a]=l}),e}function findDic(s,e){for(var t in sysdictData)if(t==s)for(var a=0;a<t.length;a++)if(sysdictData[t][a].key==e)return sysdictData[t][a].value}mui(".mui-scroll-wrapper").scroll({scrollY:!0,scrollX:!1,startX:0,startY:0,indicators:!0,deceleration:6e-4,bounce:!0});var urlObj=urlParse(),userId=urlObj.eid,ordNo=urlObj.workOrdNo,replyUlStr="",replyAutoStr="",floor,autoFloor,authorId,handlerId,status,level,replyCount,showCount,lastReply,stateChange,money,options={header:{serviceCode:"QASQueryWODetail",transCode:"TC002001"},body:{workOrdNo:ordNo}};request("http://192.168.1.33:8080/gulp/detail.json",options,function(s){console.log(s),authorId=s.authorId,handlerId=s.handlerId,status=s.workOrdStatus,level=s.workOrdLevel,replyCount=s.replayCount,showCount=replyCount,lastReply=s.lastReplyType,stateChange=s.workOrdStateChange,money=Number(s.handleAmount)+Number(s.servAmount);var e="";e+='<i class="header-string"></i><div class="header-tit"><span class="name">'+hideName(s.authorName,userId,s.authorId,s.handlerId)+'</span><span class="company">'+s.authorCompany+'</span><span class="money">'+moneyFormat(money,2)+'</span></div><div class="header-titb"><span class="time">'+timeFormat(s.submitTime)+'</span><span class="status">'+findDic("workOrdStatus",s.workOrdStatus)+"</span></div>",$(".header").html(e);var t="";t+='<span class="type">'+s.workOrdServName+'</span><span class="servNo">问题编号：'+s.workOrdServNo.slice(-6)+"</span>",$(".header-b").html(t);var a="";a+="<div>"+s.workOrdInfo+"</div>",$(".info").html(a);var l="";if(0!==s.workOrdElementList.length){for(var r=0;r<s.workOrdElementList.length;r++)l+='<div class="eleMess" data-isSecurite='+s.workOrdElementList[r].isSecurite+">"+s.workOrdElementList[r].elementName+":"+s.workOrdElementList[r].elementValue+"</div>";$(".mess").html(l),userId!==authorId&&userId!==handlerId&&$('.eleMess[data-isSecurite= "1"]').remove()}else if(0!==s.workOrdExtraList.length){for(var i=0;i<s.workOrdExtraList.length;i++)l+='<div class="extMess">'+s.workOrdExtraList[i]+"</div>";s.extraCount>3&&(l+='<div class="moreExtMess">更多数据</div>'),$(".mess").html(l)}else $(".mess").remove();var n="";0!=showCount&&("03"!==status&&"02"!==status||"01"!==lastReply)&&("01"!==stateChange&&"02"!==stateChange||"04"!==status)&&"05"!==status||showCount++,n+='<i class="reply-string"></i><div class="reply-header">回复('+showCount+")</div>",$(".replyHeader").html(n)}),request("http://192.168.1.33:8080/gulp/reply.json",options,function(s){if(console.log(s),0!=replyCount){for(var e=0;e<s.replyList.length;e++){var t=s.replyList[e],a=e+1,l=e+2;replyUlStr+='<li class="reply-content"><div class="reply-title"><i class="'+changeIcon(t.replyCustType)+'"></i><span class="titName">'+replyName(t.replyCustType,userId,authorId,handlerId)+'</span><span class="time">'+timeFormat(t.replyTime)+'</span><span class="floor">'+a+'楼</span></div><div class="reply-info">'+t.replyInfo+"</div></li>"}("03"===status||"02"===status)&&replyCount>0&&"01"===level&&"01"===lastReply?replyAutoStr='<li class="reply-content"><div class="reply-title"><i class="reply-icon-fuwuqu"></i><span class="titName">服务区</span><span class="time">'+getTime()+'</span><span class="floor">'+l+'楼</span></div><div class="reply-info">您好，我们的工作人员会在48小时内给您答复。</div></li>':("03"===status||"02"===status)&&replyCount>0&&"02"===level&&"01"===lastReply?replyAutoStr='<li class="reply-content"><div class="reply-title"><i class="reply-icon-fuwuqu"></i><span class="titName">服务区</span><span class="time">'+getTime()+'</span><span class="floor">'+l+'楼</span></div><div class="reply-info">您好，我们的工作人员会在6小时内给您答复。</div></li>':"04"===status&&"02"===stateChange?replyAutoStr='<li class="reply-content"><div class="reply-title"><i class="reply-icon-fuwuqu"></i><span class="titName">服务区</span><span class="time">'+getTime()+'</span><span class="floor">'+l+'楼</span></div><div class="reply-info">您好，问题长时间没有回复，已默认关闭，如果您的问题仍未解决可以再次提问。</div></li>':"04"===status&&"01"===stateChange?replyAutoStr='<li class="reply-content"><div class="reply-title"><i class="reply-icon-fuwuqu"></i><span class="titName">服务区</span><span class="time">'+getTime()+'</span><span class="floor">'+l+'楼</span></div><div class="reply-info">您好，问题已关闭，很高兴为您服务。</div></li>':"05"===status&&(replyAutoStr='<li class="reply-content"><div class="reply-title"><i class="reply-icon-fuwuqu"></i><span class="titName">服务区</span><span class="time">'+getTime()+'</span><span class="floor">'+l+'楼</span></div><div class="reply-info">您好，问题已撤销，如果您的问题仍未解决可以再次提问。</div></li>')}else"01"!==status&&"02"!==status||"0"!==replyCount||"01"!==level?"01"!==status&&"02"!==status||"0"!==replyCount||"02"!==level||(replyAutoStr='<li class="reply-content"><div class="reply-title"><i class="reply-icon-fuwuqu"></i><span class="titName">服务区</span><span class="time">'+getTime()+'</span><span class="floor">1楼</span></div><div class="reply-info">您好，我们的工作人员会在6小时内给您答复。</div></li>'):replyAutoStr='<li class="reply-content"><div class="reply-title"><i class="reply-icon-fuwuqu"></i><span class="titName">服务区</span><span class="time">'+getTime()+'</span><span class="floor">1楼</span></div><div class="reply-info">您好，我们的工作人员会在48小时内给您答复，请耐心等待。紧急问题，可以申请加急，加急后工作人员会在6小时内给您答复。</div></li>';replyUlStr+=replyAutoStr,$(".replyUl").html(replyUlStr)})</script></body></html>